/**
 * Allows images to be pasted into textarea editor field.
 *
 * @module      editor_marklar/imagepaster
 * @copyright   2018 David Mudr√°k <david@moodle.com>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("editor_marklar/imagepaster",["jquery","core/log","core/config"],(function($,Log,Config){function ImagePaster(textarea,imagepickeroptions,callback){this.textarea=textarea,this.imagepickeroptions=imagepickeroptions,this.callback=callback,this.initPasteListener()}return ImagePaster.prototype.initPasteListener=function(){var self=this;self.textarea.on("paste",(function(e){for(var items=e.originalEvent.clipboardData.items,i=0;i<items.length;i++){var item=items[i];0===item.type.indexOf("image/")&&self.uploadImage(item.getAsFile())}}))},ImagePaster.prototype.uploadImage=function(file){for(var self=this,filename=(1e3*Math.random()).toString().replace(".","")+"_"+file.name,repositorykeys=window.Object.keys(self.imagepickeroptions.repositories),formdata=new window.FormData,uploadrepofound=!1,i=0;i<repositorykeys.length;i++)if("upload"===self.imagepickeroptions.repositories[repositorykeys[i]].type){formdata.append("repo_id",self.imagepickeroptions.repositories[repositorykeys[i]].id),uploadrepofound=!0;break}uploadrepofound&&(formdata.append("repo_upload_file",file,filename),formdata.append("itemid",self.imagepickeroptions.itemid),formdata.append("author",self.imagepickeroptions.author),formdata.append("env",self.imagepickeroptions.env),formdata.append("sesskey",Config.sesskey),formdata.append("client_id",self.imagepickeroptions.client_id),self.imagepickeroptions.context.id&&formdata.append("ctx_id",self.imagepickeroptions.context.id),$.ajax(Config.wwwroot+"/repository/repository_ajax.php?action=upload",{type:"POST",data:formdata,dataType:"json",processData:!1,contentType:!1,async:!0}).done((function(res){"error"in res?Log.error("imagepaster: error uploading image: "+res.errorcode+": "+res.error):self.callback(res)})).fail((function(error){Log.error("imagepaster: error uploading image: "+error.status+" "+error.statusText)})))},{init:function(textareaorid,imagepickeroptions,callback){var textarea;return(textarea=$("string"==typeof textareaorid?document.getElementById(textareaorid):textareaorid)).length?imagepickeroptions?callback&&"function"==typeof callback?new ImagePaster(textarea,imagepickeroptions,callback):(Log.error("imagepaster: invalid callback specified"),!1):(Log.error("imagepaster: invalid image picker options"),!1):(Log.error("imagepaster: invalid editor textarea element"),!1)}}}));

//# sourceMappingURL=imagepaster.min.js.map