define(["jquery","core/log","core/config"],function(a,b,c){"use strict";function d(a,b,c){var d=this;d.textarea=a,d.imagepickeroptions=b,d.callback=c,d.initPasteListener()}return d.prototype.initPasteListener=function(){var a=this;a.textarea.on("paste",function(b){for(var c=b.originalEvent.clipboardData.items,d=0;d<c.length;d++){var e=c[d];0===e.type.indexOf("image/")&&a.uploadImage(e.getAsFile())}})},d.prototype.uploadImage=function(d){for(var e=this,f=(1e3*Math.random()).toString().replace(".","")+"_"+d.name,g=window.Object.keys(e.imagepickeroptions.repositories),h=new window.FormData,i=!1,j=0;j<g.length;j++)if("upload"===e.imagepickeroptions.repositories[g[j]].type){h.append("repo_id",e.imagepickeroptions.repositories[g[j]].id),i=!0;break}i&&(h.append("repo_upload_file",d,f),h.append("itemid",e.imagepickeroptions.itemid),h.append("author",e.imagepickeroptions.author),h.append("env",e.imagepickeroptions.env),h.append("sesskey",c.sesskey),h.append("client_id",e.imagepickeroptions.client_id),e.imagepickeroptions.context.id&&h.append("ctx_id",e.imagepickeroptions.context.id),a.ajax(c.wwwroot+"/repository/repository_ajax.php?action=upload",{type:"POST",data:h,dataType:"json",processData:!1,contentType:!1,async:!0}).done(function(a){"error"in a?b.error("imagepaster: error uploading image: "+a.errorcode+": "+a.error):e.callback(a)}).fail(function(a){b.error("imagepaster: error uploading image: "+a.status+" "+a.statusText)}))},{init:function(c,e,f){var g;return g=a("string"==typeof c?document.getElementById(c):c),g.length?e?f&&"function"==typeof f?new d(g,e,f):(b.error("imagepaster: invalid callback specified"),!1):(b.error("imagepaster: invalid image picker options"),!1):(b.error("imagepaster: invalid editor textarea element"),!1)}}});